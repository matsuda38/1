# Authentication Requirements

## ログイン方式
- **Email Link / Passwordless**: 基本フローとしてメールマジックリンクによるサインインを必須とする。パスワード管理コストを避けつつ、初回アクセスのハードルを下げる。
- **OTP (One-Time Passcode)**: メールリンクが利用できないケースに備え、メールベースのOTPによるフォールバックを想定。SMSは現時点では必須ではないが、運用開始後の国際展開状況を見て検討する。
- **OAuth**: GoogleおよびGitHubを優先候補とし、B2B/B2C双方で利用頻度が高いプロバイダから順次追加。初期リリースでは最低1種のOAuthプロバイダをサポートする。

## MFA / セッション寿命 / Remember me
- **MFA**: センシティブデータを扱うため、TOTPベースのMFAをオプションとして提供。管理者ロールにはMFA必須ポリシーを適用する。
- **セッション寿命**: ブラウザセッションは24時間で自動失効、リフレッシュトークンは14日。機密操作（管理画面など）は追加で直近15分以内の再認証を要求。
- **Remember me**: 選択式の"Remember me"チェックボックスを提供し、選択時はリフレッシュトークンを活用して自動再ログインを許可（前述の14日制限内）。

## SSO / SAML / 組織・チーム
- **SSO/SAML**: エンタープライズ顧客向けにSAML 2.0対応をロードマップに含める。初期バージョンのPOCでは必須ではないが、将来的な実装容易性を評価。
- **組織/チーム概念**: マルチテナントを前提とし、ワークスペース（組織）配下に複数メンバーを招待できる構造を採用。ロールベースアクセス制御（Admin/Member/Viewer）を想定。

## 監査・データ所在地
- **監査ログ**: ログイン/ログアウト、MFA有効化、パスワードレスリンク発行、ロール変更などを監査ログとして保存。少なくとも90日間保持し、エクスポート可能とする。
- **IP制限**: 管理者ロールについては固定IPアドレスまたはCIDRでのアクセス制限をサポート。利用者単位でのIPアラート（未知のIPからのログイン通知）を検討。
- **データ所在地**: デフォルトは米国リージョン。EU/日本からのコンプライアンス要求に応じてデータレジデンシーを切り替えられるプロバイダを優先的に評価。

## コスト目安（試算）
- **前提**: 月間アクティブユーザー(MAU) 5,000 / 月間サインイン 15,000（1人あたり3回）を想定。
- **Clerk**: Free枠(5,000 MAU)内に収まるが、将来的な余裕を見てStandardプラン($55/月〜)を計画。追加MAUは$0.01/MAU程度。
- **Supabase**: Freeプランは50,000月間認証リクエストまで。PostgreSQL/RLS利用に伴う有料プラン（Pro: $25/月）も初年度内に移行する想定。
- **その他**: SMS送信（将来MFA用）をTwilio等で併用する場合、1通$0.05前後を別途計上。
